"use strict";(self.webpackChunkbublik_release=self.webpackChunkbublik_release||[]).push([[4162],{3546:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>l});var r=s(9729);const i={},c=r.createContext(i);function d(e){const n=r.useContext(c);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(c.Provider,{value:n},e.children)}},9177:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>x,frontMatter:()=>d,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"development/index","title":"Development","description":"This is experimental and subject to change.","source":"@site/docs/07-development/index.md","sourceDirName":"07-development","slug":"/development/","permalink":"/bublik-release/development/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Development"},"sidebar":"defaultSidebar","previous":{"title":"Commands","permalink":"/bublik-release/management/command"},"next":{"title":"Docker","permalink":"/bublik-release/docker/"}}');var i=s(5813),c=s(3546);const d={title:"Development"},l="Docker Setup Guide",o={},t=[{value:"Install Docker and Docker Compose",id:"install-docker-and-docker-compose",level:2},{value:"Reset Docker Environment",id:"reset-docker-environment",level:2},{value:"Rebuild Environment",id:"rebuild-environment",level:2},{value:"Watch Mode",id:"watch-mode",level:2},{value:"Running Commands in the Container",id:"running-commands-in-the-container",level:2},{value:"Ports",id:"ports",level:2},{value:"Example <code>.env</code> Configuration",id:"example-env-configuration",level:2}];function h(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsxs)(n.p,{children:["This is experimental and subject to change.",(0,i.jsx)("br",{}),"\nDo not use it if you don't know what you are doing"]})}),"\n",(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"docker-setup-guide",children:"Docker Setup Guide"})}),"\n",(0,i.jsxs)(n.p,{children:["This guide explains how to set up and run the project using Docker on ",(0,i.jsx)(n.strong,{children:"Ubuntu 24.10 aarch64"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"install-docker-and-docker-compose",children:"Install Docker and Docker Compose"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Install Docker"}),(0,i.jsx)(n.br,{}),"\n","Follow the official ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/install/ubuntu/",children:"Docker installation guide for Ubuntu"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Post-installation steps"}),(0,i.jsx)(n.br,{}),"\n","After installing Docker, run the post-installation steps:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/install/linux-postinstall/",children:"Docker Post-installation Setup"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Install Docker Compose"}),(0,i.jsx)(n.br,{}),"\n","Follow the installation instructions for ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/compose/install/",children:"Docker Compose"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Verify Installation"}),(0,i.jsx)(n.br,{}),"\n","Ensure Docker and Docker Compose are installed by running the following commands:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"docker --version"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"docker compose version"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"reset-docker-environment",children:"Reset Docker Environment"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Stop and remove containers"}),(0,i.jsx)(n.br,{}),"\n","Run the command:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"docker compose -f docker-compose.dev.yml --progress plain --env-file .env down"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Check for remaining containers"}),(0,i.jsx)(n.br,{}),"\n",'Ensure no containers with the prefix "bublik-*" remain:',(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"docker ps -a"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remove Docker volumes"}),(0,i.jsx)(n.br,{}),"\n","Delete all volumes with:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"docker volume ls -q | xargs -r docker volume rm"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Check volumes"}),(0,i.jsx)(n.br,{}),"\n",'Ensure volumes with the prefix "bublik_*" are removed:',(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"docker volume ls"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remove Docker images"}),(0,i.jsx)(n.br,{}),"\n","Delete all images:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"docker images -q | xargs -r docker rmi -f"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Clean up Docker system"}),(0,i.jsx)(n.br,{}),"\n","Remove all unused containers, volumes, images, and networks:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"docker system prune -a -f"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"rebuild-environment",children:"Rebuild Environment"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Clone the repository"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"git clone <PLACEHOLDER>"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Navigate to the project directory"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"cd ./bublik"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Switch to the Docker branch"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"git switch docker"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Initialize and update submodules"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"git submodule init && git submodule update"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Check if the UI is initialized"}),(0,i.jsx)(n.br,{}),"\n","Verify the presence of the Dockerfile:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"ls ./bublik-ui/apps/bublik/Dockerfile"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Check if Test Environment (TE) is initialized"}),(0,i.jsx)(n.br,{}),"\n","Verify the dispatcher script:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"ls ./test-environment/dispatcher.sh"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Check for config file"}),(0,i.jsx)(n.br,{}),"\n","Verify the config file exists:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"ls ./bublik-conf/xce/dpdk/per_conf.py"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Create a ",(0,i.jsx)(n.code,{children:".env"})," file"]}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"touch .env"}),(0,i.jsx)(n.br,{}),"\n","Add the necessary configuration (example below)."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Start Docker containers"}),(0,i.jsx)(n.br,{}),"\n","Run the following command to start the containers:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"docker compose -f docker-compose.dev.yml --progress plain --env-file .env up"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Verify the Django container"}),(0,i.jsx)(n.br,{}),"\n","Check the container ID:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"docker ps"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Access the container"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"docker exec -it <container_id> bash"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Create a superuser"}),(0,i.jsx)(n.br,{}),"\n","Inside the container, run:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"./manage.py createsuperuser"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Migrate the database"}),(0,i.jsx)(n.br,{}),"\n","Visit ",(0,i.jsx)(n.a,{href:"http://localhost/v2/admin/config",children:"http://localhost/v2/admin/config"}),' and click "Migrate".']}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"watch-mode",children:"Watch Mode"}),"\n",(0,i.jsxs)(n.p,{children:["To automatically update the UI and backend when code changes, start the environment with the ",(0,i.jsx)(n.code,{children:"--watch"})," flag:\n",(0,i.jsx)(n.code,{children:"docker compose -f docker-compose.dev.yml --progress plain --env-file .env up --watch"})]}),"\n",(0,i.jsx)(n.h2,{id:"running-commands-in-the-container",children:"Running Commands in the Container"}),"\n",(0,i.jsx)(n.p,{children:"To execute Django management commands, follow these steps:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Find the container ID"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"docker ps"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Access the container"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"docker exec -it <container_id> bash"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Run the command"}),(0,i.jsx)(n.br,{}),"\n","Execute the desired Django management command, for example:",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"./manage.py <command>"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Create a superuser"}),(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.code,{children:"./manage.py createsuperuser"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"ports",children:"Ports"}),"\n",(0,i.jsx)(n.p,{children:"Here are the ports exposed to the host for each service:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Service"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Purpose"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Host Port"})}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.strong,{children:"Container Port"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Django"})}),(0,i.jsx)(n.td,{children:"Django web server"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"8000"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"8000"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Postgres"})}),(0,i.jsx)(n.td,{children:"PostgreSQL database"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"5432"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"5432"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Redis"})}),(0,i.jsx)(n.td,{children:"Redis cache"}),(0,i.jsx)(n.td,{children:"Not exposed"}),(0,i.jsx)(n.td,{children:"Not exposed"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"RabbitMQ"})}),(0,i.jsx)(n.td,{children:"RabbitMQ message broker"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"5672"}),", ",(0,i.jsx)(n.code,{children:"15672"})]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"5672"}),", ",(0,i.jsx)(n.code,{children:"15672"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Flower"})}),(0,i.jsx)(n.td,{children:"Celery task monitoring"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"5555"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"5555"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Nginx"})}),(0,i.jsx)(n.td,{children:"Nginx web server"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"80"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"80"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Bublik UI"})}),(0,i.jsx)(n.td,{children:"Frontend user interface"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"4200"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"4200"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Mailpit"})}),(0,i.jsx)(n.td,{children:"Test email (web interface and SMTP)"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"8025"}),", ",(0,i.jsx)(n.code,{children:"1025"})]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"8025"}),", ",(0,i.jsx)(n.code,{children:"1025"})]})]})]})]}),"\n",(0,i.jsxs)(n.h2,{id:"example-env-configuration",children:["Example ",(0,i.jsx)(n.code,{children:".env"})," Configuration"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"BUBLIK_ACCESS_LOG=/app/bublik/logs/bublik-rest.access.log\nBUBLIK_BIND_GUNICORN=0.0.0.0:8000\nBUBLIK_GRACEFUL_TIMEOUT=1200\nBUBLIK_LOG=/app/bublik/logs/bublik-rest.log\nBUBLIK_LOGDIR=/app/bublik/logs\nBUBLIK_SRC=/app/bublik\nBUBLIK_TIMEOUT=1200\nBUBLIK_UI_DIR=/app/bublik-ui\nBUBLIK_WEB_NAME=Bublik\nBUBLIK_WORKERS=8\nCELERYD_MAX_TASKS_PER_CHILD=1\nCELERY_ACCEPT_CONTENT=application/json\nCELERY_APP=bublik.interfaces\nCELERY_BROKER_URL=amqp://rabbitmq\nCELERY_CREATE_DIRS=1\nCELERY_LOG_LEVEL=INFO\nCELERY_RESULT_BACKEND=rpc://\nCELERY_RESULT_SERIALIZER=json\nCELERY_TASK_SERIALIZER=json\nDB_HOST=db\nDB_NAME=bublik\nDB_PASSWORD=bublik\nDB_PORT=5432\nDB_USER=bublik\nDOLLAR=$\nEMAIL_ADMINS=admin@bublik.com\nEMAIL_FROM=admin@bublik.com\nEMAIL_HOST=mailpit\nEMAIL_PORT=1025\nEMAIL_USE_TLS=False\nENABLE_JSON_LOGS_PROXY=True\nFLOWER_PERSISTENT=True\nFLOWER_PORT=5555\nFLOWER_URL_PREFIX=flower\nMANAGEMENT_COMMANDS_LOG=/app/bublik/logs/bublik-management-commands\nPER_CONF_DIR=/app/bublik/bublik-conf/xce/dpdk\nREDIS_HOST=redis\nSECRET_KEY=BUBLIK_DEV_SECRET_KEY\nSECURE_HTTP=True\nTE_BASE=/app/te\nTMPDIR=/tmp\nURL_PREFIX=\n"})})]})}function x(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);