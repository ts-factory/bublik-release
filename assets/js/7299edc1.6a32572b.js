"use strict";(self.webpackChunkbublik_release=self.webpackChunkbublik_release||[]).push([[2441],{3546:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>t});var i=s(9729);const r={},o=i.createContext(r);function l(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(o.Provider,{value:n},e.children)}},8718:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"docker/post-deploy","title":"Post Deploy","description":"Now that your Bublik instance is running at the specified FQDN, you\'re ready to import your first log.","source":"@site/docs/08-docker/02-post-deploy.md","sourceDirName":"08-docker","slug":"/docker/post-deploy","permalink":"/bublik-release/docker/post-deploy","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Post Deploy"},"sidebar":"defaultSidebar","previous":{"title":"Setup","permalink":"/bublik-release/docker/setup"},"next":{"title":"Commands","permalink":"/bublik-release/docker/commands"}}');var r=s(5813),o=s(3546);const l={title:"Post Deploy"},t=void 0,c={},d=[{value:"Directory Structure",id:"directory-structure",level:2},{value:"Directory Purposes",id:"directory-purposes",level:3},{value:"Publishing Logs",id:"publishing-logs",level:2},{value:"Input Requirements",id:"input-requirements",level:3},{value:"Publishing Process",id:"publishing-process",level:3},{value:"Import Log",id:"import-log",level:2},{value:"UI",id:"ui",level:3},{value:"API",id:"api",level:3},{value:"Archive",id:"archive",level:3},{value:"Command",id:"command",level:3},{value:"FAQ",id:"faq",level:2},{value:"How to reset db?",id:"how-to-reset-db",level:3},{value:"URL doesn&#39;t matched project references",id:"url-doesnt-matched-project-references",level:3},{value:"Solution",id:"solution",level:4}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Now that your ",(0,r.jsx)(n.strong,{children:"Bublik"})," instance is running at the specified ",(0,r.jsx)(n.strong,{children:"FQDN"}),", you're ready to import your first log."]}),"\n",(0,r.jsx)(n.h2,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,r.jsxs)(n.p,{children:["After setting ",(0,r.jsx)(n.code,{children:"BUBLIK_DOCKER_DATA_DIR"})," and launching the application, it creates the following structure:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"<BUBLIK_DOCKER_DATA_DIR>/\n\u251c\u2500\u2500 django-logs/           # Application logs\n\u2514\u2500\u2500 logs/                 # Test logs storage\n    \u251c\u2500\u2500 bad/             # Failed imports\n    \u251c\u2500\u2500 incoming/        # Temporary storage for logs waiting to be published\n    \u2514\u2500\u2500 logs/            # Put your logs in this folder\n        \u2514\u2500\u2500 ...          # Your test logs\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsxs)(n.p,{children:["The example below shows a possible structure with ",(0,r.jsx)(n.code,{children:"net-drv-ts"})," as a test suite directory, but you can organize your logs in any way that suits your needs:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"<BUBLIK_DOCKER_DATA_DIR>/\nlogs/\n\u2514\u2500\u2500 logs/\n    \u2514\u2500\u2500 net-drv-ts/      # Example test suite directory\n"})})]}),"\n",(0,r.jsx)(n.h3,{id:"directory-purposes",children:"Directory Purposes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"incoming/"})}),": Temporary storage for logs waiting to be published"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"logs/"})}),": Contains all successfully published logs, accessible at ",(0,r.jsx)(n.code,{children:"<BUBLIK_FQDN>/logs/"}),". You can organize test logs in this directory using any structure"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"bad/"})}),": Storage for logs that failed during the publishing process"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"publishing-logs",children:"Publishing Logs"}),"\n",(0,r.jsx)(n.h3,{id:"input-requirements",children:"Input Requirements"}),"\n",(0,r.jsxs)(n.p,{children:["Each log must be a ",(0,r.jsx)(n.strong,{children:"GNU tar archive"})," containing two mandatory files:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"meta_data.json"})," - contains metadata about the log"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"raw_log_bundle.tpxz"})," - the actual log content"]}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"warning",children:[(0,r.jsxs)(n.p,{children:["Documentation is currently in progress. ",(0,r.jsx)("br",{}),"\nPlease check back later for updates.",(0,r.jsx)("br",{}),"\nTODO:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Add other allowed files"}),"\n"]})]}),"\n",(0,r.jsx)(n.h3,{id:"publishing-process",children:"Publishing Process"}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["These command also trigger automatic import of the log into ",(0,r.jsx)(n.strong,{children:"Bublik"})," database"]})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Copy your log archive(s) to the ",(0,r.jsx)(n.code,{children:"incoming"})," directory"]}),"\n",(0,r.jsx)(n.li,{children:"Run the publish command:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"task publish\n"})}),"\n",(0,r.jsx)(n.p,{children:"You also can import log archive directly via this command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"task import -- <path/to/my_log.tar>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Once log published you should be able to see it at ",(0,r.jsx)(n.code,{children:"<BUBLIK_FQDN>/logs/"}),"\nSince import is automatically triggered you should be able see running import logs at ",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(n.a,{href:"http://localhost/v2/admin/import",children:"http://localhost/v2/admin/import"})]}),"\n",(0,r.jsx)(n.h2,{id:"import-log",children:"Import Log"}),"\n",(0,r.jsxs)(n.p,{children:["Import process is mainly is a background process and you view and monitor logs at ",(0,r.jsx)("br",{})]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"<BUBLIK_FQDN>/v2/admin/import/"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"<BUBLIK_FQDN>/flower/"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"You can import logs in multiple ways:"}),"\n",(0,r.jsx)(n.h3,{id:"ui",children:"UI"}),"\n",(0,r.jsx)(n.p,{children:"You can also issue import via using UI"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Go to ",(0,r.jsx)(n.code,{children:"<BUBLIK_FQDN>/v2/admin/import"})]}),"\n",(0,r.jsx)(n.li,{children:'Press "Import" button in the top right corner of the screen'}),"\n",(0,r.jsx)(n.li,{children:"Specify single URL or multiple URLs for logs to import"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"api",children:"API"}),"\n",(0,r.jsxs)(n.p,{children:["You can also import log from remote logs storage via using ",(0,r.jsx)(n.strong,{children:"Bublik"})," API by issuing GET request"]}),"\n",(0,r.jsx)(n.p,{children:"We provide shortcut for this command with:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# This calls under the hood:\n# curl <BUBLIK_FQDN>/api/v2/importruns/source/?url=<log_url>\ntask import-remote -- <log_url>\n"})}),"\n",(0,r.jsx)(n.h3,{id:"archive",children:"Archive"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"task import -- <path/to/tar-archive>.tar\n"})}),"\n",(0,r.jsx)(n.h3,{id:"command",children:"Command"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"task import-command -- <log_url>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,r.jsx)(n.h3,{id:"how-to-reset-db",children:"How to reset db?"}),"\n",(0,r.jsx)(n.admonition,{type:"danger",children:(0,r.jsxs)(n.p,{children:["This is dangerous operation ",(0,r.jsx)("br",{}),"\nPlease, create db backup before doing anything via ",(0,r.jsx)(n.code,{children:"task backup:create"})," ",(0,r.jsx)("br",{}),"\nProceed with caution!"]})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"task down"})," - remove running containers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"docker volume ls"})," - locate db volume (be default it should be ",(0,r.jsx)(n.code,{children:"bublik_db_data"}),", depends on project name from ",(0,r.jsx)(n.code,{children:".env"})," file)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"docker volume rm <volume_name>"})," - to delete db"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"task up"})," - db will be create again"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"url-doesnt-matched-project-references",children:"URL doesn't matched project references"}),"\n",(0,r.jsxs)(n.p,{children:["This is caused by misconfiguring ",(0,r.jsx)(n.code,{children:"references"})," config\nFor example if you try to import log from: ",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(n.a,{href:"https://example.com/logs/",children:"https://example.com/logs/"})]}),"\n",(0,r.jsx)(n.h4,{id:"solution",children:"Solution"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Go to ",(0,r.jsx)(n.code,{children:"<BUBLIK_FQDN>/v2/admin/config"})]}),"\n",(0,r.jsxs)(n.li,{children:["Find ",(0,r.jsx)(n.code,{children:"references"})," config"]}),"\n",(0,r.jsxs)(n.li,{children:["Add or edit ",(0,r.jsx)(n.code,{children:"LOGS_BASES"})," to include from where you try to import logs"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "uri": ["https://example.com/logs/"],\n  "name": "Example log base"\n},\n'})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);